'use strict';

(function(){

window.journalEntries = [
    {
      "id": "8pghmwUxYSepB9jNufVl2M",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T15:00:31.508Z",
      "description": "4 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3310.pdf",
      "version": 1
    },
    {
      "id": "9ZP07snpLcVGmT9HzU3pWD",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:59:25.676Z",
      "description": "6 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3309.pdf",
      "version": 1
    },
    {
      "id": "QOIsYn2L8AucrC843eFvMz",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:58:19.812Z",
      "description": "4 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3308.pdf",
      "version": 1
    },
    {
      "id": "mNBkpxFvdYj4507XB3jSnl",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:57:13.637Z",
      "description": "6 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3307.pdf",
      "version": 1
    },
    {
      "id": "rnN9IiAit6EZEkhGcohFiZ",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:56:07.879Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3306.pdf",
      "version": 1
    },
    {
      "id": "ukBMSPxZttLENtMi3Xinj0",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:55:01.316Z",
      "description": "4 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3305.pdf",
      "version": 1
    },
    {
      "id": "2nBPyVpTskTrCvlqQOkZTd",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:53:55.174Z",
      "description": "6 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3304.pdf",
      "version": 1
    },
    {
      "id": "uYmUoD1CGCN4FJRjI5oVN3",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:52:49.146Z",
      "description": "7 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3303.pdf",
      "version": 1
    },
    {
      "id": "xwo5xCXgz0dZBWkZxBtPvX",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:51:43.734Z",
      "description": "2 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3302.pdf",
      "version": 1
    },
    {
      "id": "r1HlwGCP4tzvjnMyfh5GQ1",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:50:37.020Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3301.pdf",
      "version": 1
    },
    {
      "id": "2zGcnjUnDGGVUU5WmiId4V",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:49:31.105Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3300.pdf",
      "version": 1
    },
    {
      "id": "MJ9ijLPsXy9GwsIj4mk3k8",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:48:25.410Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3299.pdf",
      "version": 1
    },
    {
      "id": "Kvd25EgFQiKsygS2lvnFEf",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:47:19.166Z",
      "description": "4 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3298.pdf",
      "version": 1
    },
    {
      "id": "LRyE3v3Pxe3Hh83V0bYVry",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:46:13.156Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3297.pdf",
      "version": 1
    },
    {
      "id": "a8iO7JxZEPljwjEMRlJBXs",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:45:06.713Z",
      "description": "2 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3296.pdf",
      "version": 1
    },
    {
      "id": "V9KGM6VtCQpe7uXavM0qjx",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:44:00.341Z",
      "description": "3 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3295.pdf",
      "version": 1
    },
    {
      "id": "ghgu5KQ1KaDvDSlcJaBF1y",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:42:54.614Z",
      "description": "3 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3294.pdf",
      "version": 1
    },
    {
      "id": "J7Ffv2zmuzJgGCBfsAFDVs",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:41:48.327Z",
      "description": "2 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3293.pdf",
      "version": 1
    },
    {
      "id": "KsxRDAJWkHFIWHZfIgguhb",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:40:43.074Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3292.pdf",
      "version": 1
    },
    {
      "id": "Qd4YEPfX8y1TK4Yacqhyhw",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:39:37.429Z",
      "description": "2 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3291.pdf",
      "version": 1
    },
    {
      "id": "NVrlrQI0gn8K0oOi40IO5T",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:38:30.750Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3290.pdf",
      "version": 1
    },
    {
      "id": "WNDUNmIC8tL8CEuuaj8w9F",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:37:24.201Z",
      "description": "3 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3289.pdf",
      "version": 1
    },
    {
      "id": "1OtC2fMJrMWNACoyPtNRED",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:36:18.087Z",
      "description": "2 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3288.pdf",
      "version": 1
    },
    {
      "id": "HAoo6erRUJMEF3EEA11tBL",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:35:11.792Z",
      "description": "1 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3287.pdf",
      "version": 1
    },
    {
      "id": "E6VbF5b010lAEUfFwMRLS8",
      "book": "7klMwkWbY7HWR8qqq24W5U",
      "effective_at": "2014-07-26T14:34:06.288Z",
      "description": "2 lemonade(s) sold",
      "reference": "https://s3-us-west-2.amazonaws.com/demo-references/receipt3286.pdf",
      "version": 1
    }
  ];

  /* Controllers */

  var spexieAppControllers = angular.module('spexieApp.controllers', []);

  spexieAppControllers.controller(
    'appCtrl',
    [
      '$scope',
      function($scope) {
        $scope.loggedIn = true;
        $scope.logIn = function(){
          $scope.loggedIn = true;
        };
        $scope.logOut = function(){
          $scope.loggedIn = false;
        };
        $scope.alert = false;
      }
    ]
  );

  spexieAppControllers.controller(
    'selectCtrl',
    [
      '$scope',
      function($scope) {
        $scope.states = ['posted', 'posting', 'active', 'archived'];
        $scope.state = 'posted';
        $scope.setState = function(){
          console.log($scope.state);
          $scope.changeState($scope.state);
        };
      }
    ]
  );

  spexieAppControllers.controller(
    'AccountsCtrl',
    [
      '$scope',
      'sledgerSvc',
      function($scope, sledgerSvc){
        $scope.state = $scope.state || 'active';
        $scope.type = $scope.type || $scope.state + '_accounts';
        $scope.query = function(options){
          $scope.type = $scope.state + '_accounts';
          options = options || {state: $scope.state};
          sledgerSvc.getAccounts(options).then(
            function(apiRes){ $scope.accounts = apiRes[$scope.type]; },
            function(error){ $scope.error = error; }
          );
        };
        $scope.init = function(){
          $scope.query();
        };
      }
    ]
  );

  spexieAppControllers.controller(
    'AccountCtrl',
    [
      '$scope',
      'sledgerSvc',
      '$routeParams',
      function($scope, sledgerSvc, $routeParams){
        $scope.state = 'active';
        $scope.type = $scope.state + '_account';
        $scope.query = function(actId){
          actId = actId || $routeParams.accountId;
          $scope.type = $scope.state + '_account';
          sledgerSvc.getAccount(actId).then(
            function(apiRes){ $scope.account = apiRes[$scope.type]; },
            function(error){ $scope.error = error; }
          );
        };
        $scope.init = function(actId){
          $scope.query(actId);
        };
      }
    ]
  );

  spexieAppControllers.controller(
    'JournalEntriesCtrl',
    [
      '$scope',
      'sledgerSvc',
      function($scope, sledgerSvc){
        $scope.state = 'posted';
        $scope.type = 'posted_journal_entries';
        $scope.query = function(){
          $scope.alert = false;
          // sledgerSvc.getJournalEntries({state: $scope.state}).then(
          //   function(apiRes){
          //     $scope.journalEntries = apiRes[$scope.type];
          //     if($scope.journalEntries.length === 0){ $scope.alert = true; }
          //   },
          //   function(error){ $scope.error = error; }
          // );

          $scope.journalEntries = window.journalEntries;
        };
        $scope.init = function(){
          $scope.query();
        };
        $scope.changeState = function(newState){
          $scope.type = newState + '_journal_entries';
          $scope.state = newState;
          $scope.query();
        };
      }
    ]
  );

  spexieAppControllers.controller(
    'JournalEntryCtrl',
    [
      '$scope',
      'sledgerSvc',
      '$routeParams',
      function($scope, sledgerSvc, $routeParams){
        $scope.listing = true;
        $scope.state = $scope.state || 'posted';
        $scope.type = $scope.state + '_journal_entry';
        $scope.query = function(jeId){
          $scope.type = $scope.state + '_journal_entry';
          jeId = jeId || $routeParams.jeId;
          sledgerSvc.getJournalEntry(jeId).then(
            function(apiRes){ $scope.journalEntry = apiRes[$scope.type]; },
            function(error){ $scope.error = error; }
          );
        };
        $scope.toggleView = function(){
          $scope.listing = !$scope.listing;
          if($scope.listing === false){
            $scope.$broadcast('getLines', $scope.journalEntry.id);
            $scope.getBalance();
          }
        };
        $scope.init = function(jeId){
          $scope.query(jeId);
        };
        $scope.getBalance = function(jeId){
          jeId = jeId || $scope.journalEntry.id;
          sledgerSvc.getJournalEntryBalance(jeId).then(
            function(apiRes){
              $scope.jeBalance = apiRes['balance'];
            },
            function(error){ $scope.error = error; }
          );
        };
      }
    ]
  );

  spexieAppControllers.controller(
    'LinesCtrl',
    [
      '$scope',
      'sledgerSvc',
      '$routeParams',
      function($scope, sledgerSvc, $routeParams){
        $scope.state = $scope.state || 'posted';
        $scope.type = $scope.type || $scope.state + '_lines';
        $scope.query = function(jeId, options){
          jeId = jeId || $routeParams.jeId;
          options = options || {state: 'posted'};
          $scope.type = $scope.state + '_lines';
          sledgerSvc.getLines(jeId, options).then(
            function(apiRes){
              $scope.lines = apiRes[$scope.type];
            },
            function(error){ $scope.error = error; }
          );
        };
        $scope.$on('getLines', function(e, id) {
          if (!$scope.lines) {
            $scope.query(id);
          }
        });
        this.credit = function(value){
          if(value.type === 'credit'){ return value.amount; }
        };
        this.debit = function(value){
          if(value.type === 'debit'){ return value.amount; }
        };
        $scope.init = function(jeId){
          $scope.query(jeId);
        };
      }
    ]
  );

  spexieAppControllers.controller(
    'LineCtrl',
    [
      '$scope',
      'sledgerSvc',
      '$routeParams',
      function($scope, sledgerSvc, $routeParams){
        sledgerSvc.getLine($routeParams.journalEntryId, $routeParams.lineId).then(
          function(apiRes){ $scope.line = apiRes.posted_line; },
          function(error){ $scope.error = error; }
        );
      }
    ]
  );


    // .controller('jeCtrl', ['$scope', function($scope) {
    //   this.entries = [
    //     {effectiveAt: 'a day ago', description: 'je one', posted: 'posted'},
    //     {effectiveAt: 'a day ago', description: 'je two', posted: 'posted'}
    //   ];
    // }])
    // .controller('MyCtrl1', ['$scope', function($scope) {

    // }])
    // .controller('MyCtrl2', ['$scope', function($scope) {

    // }]);

})();
